---
title: (ë²ˆì—­) Mastering Mutations in React Query
date: 2024-05-27
description: Mastering Mutations in React Query ë²ˆì—­
---

## Table of Contents

## ë³¸ë¬¸

> [TkDodo](https://github.com/tkdodo)ì˜ [Mastering Mutations in React Query](https://tkdodo.eu/blog/mastering-mutations-in-react-query)ë¥¼ ë²ˆì—­í•œ ë¬¸ì„œìž…ë‹ˆë‹¤.

ì•žì„œ ì €í¬ëŠ” React Queryê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ê³¼ ê°œë…ì— ëŒ€í•´ ë§Žì´ ë‹¤ë¤„ì™”ìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” `useQuery` ë¥¼ í†µí•´ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ”ë° ìžˆì–´ì„œ 2ë²ˆì§¸ë¡œ ì¤‘ìš”í•œ ê²ƒì´ ìžˆìŠµë‹ˆë‹¤. ë°”ë¡œ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤.

ì´ëŸ¬í•œ ì‚¬ìš© ì‚¬ë¡€ì— ëŒ€í•´ React QueryëŠ” `useMutation` í›…ì„ ì œê³µí•©ë‹ˆë‹¤.

## ë³€í˜•(mutations)ì´ ë­˜ê¹Œìš”? (What are mutations?)

ì¼ë°˜ì ìœ¼ë¡œ ë³€í˜•(mutation)ì´ëž€ ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ê°–ëŠ” í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ˆì‹œë¡œ ë°°ì—´ì˜ `push` ë©”ì†Œë“œë¥¼ ì‚´íŽ´ë³´ë©´, ê°’ì„ ë°°ì—´ì— ì¶”ê°€í•˜ëŠ” ë¶€ë¶„ì—ì„œ ë°°ì—´ì— ë³€í˜•ì„ ì¼ìœ¼í‚¤ëŠ” ë¶€ìˆ˜ íš¨ê³¼ê°€ ìžˆìŠµë‹ˆë‹¤.

```tsx
// mutable-array-push

const myArray = [1];
myArray.push(2);

console.log(myArray); // [1, 2]
```

ë¶ˆë³€ì„±ì„ ì§€í‚¬ ìˆ˜ ìžˆëŠ” ë©”ì†Œë“œëŠ” `concat`ì¼ ê²ƒìž…ë‹ˆë‹¤: ë°°ì—´ì— ê°’ì„ ì¶”ê°€í•˜ì§€ë§Œ í˜„ìž¬ ìž‘ì—… ì¤‘ì¸ ë°°ì—´ì„ ì§ì ‘ì ìœ¼ë¡œ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ìƒˆë¡œìš´ ë°°ì—´ì„ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤.

```tsx
// immutable-array-concat

const myArray = [1];
const newArray = myArray.concat(2);

console.log(myArray); //  [1]
console.log(newArray); // [1, 2]
```

ì´ë¦„ì—ì„œ ë‚˜íƒ€ë‚˜ë“¯ì´, _useMutation_ ì€ ì–´ë–¤ ì¢…ë¥˜ì˜ ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ê°–ê³  ìžˆìŠµë‹ˆë‹¤. React Queryë¥¼ í†µí•´ [ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬](https://tkdodo.eu/blog/react-query-as-a-state-manager)í•˜ëŠ” ë§¥ë½ì—ì„œ ë³´ë©´, ë³€í˜•ì€ _ì„œë²„ì—ì„œ_ ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•  ì¼ì„ ìƒì„±í•˜ëŠ” ê²ƒì€ ë³€í˜•ì¼ ê²ƒìž…ë‹ˆë‹¤. ì‚¬ìš©ìžë¥¼ ë¡œê·¸ì¸ ì‹œí‚¤ëŠ” ê²ƒë„ í´ëž˜ì‹í•œ ë³€í˜•ì¼ ê²ƒìž…ë‹ˆë‹¤. ì‚¬ìš©ìžë¥¼ ìœ„í•œ í† í°ì„ ìƒì„±í•˜ëŠ” ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤.

ì–´ë–¤ ì¸¡ë©´ì—ì„œ ë³´ë©´ `useMutation` ì€ `useQuery` ì™€ ë§¤ìš° ìœ ì‚¬í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¤ë¥¸ ì¸¡ë©´ì—ì„œ ë³´ë©´ ìƒë‹¹í•œ ì°¨ì´ê°€ ìžˆìŠµë‹ˆë‹¤.

## useQuery ì™€ì˜ ì°¨ì´ì  (Differences to useQuery)

**useQuery ëŠ” ì„ ì–¸í˜•ì´ë©° useMutation ì€ ëª…ë ¹í˜•ìž…ë‹ˆë‹¤.**

ì´ ë§ì€ ëŒ€ë¶€ë¶„ì˜ ì¿¼ë¦¬ê°€ ìžë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì˜ì¡´ì„±ì„ ì •ì˜í•´ë„ React QueryëŠ” í•„ìš”ì— ë”°ë¼ ì¿¼ë¦¬ë¥¼ ì¦‰ì‹œ ì‹¤í–‰í•˜ê³  ë˜‘ë˜‘í•œ ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìžˆë„ë¡ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” ì¿¼ë¦¬ì™€ ìž˜ ìž‘ë™í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ìš°ë¦¬ëŠ” í™”ë©´ì—ì„œ ë³´ëŠ” ë°ì´í„°ë¥¼ ë°±ì—”ë“œì— ìžˆëŠ” ì‹¤ì œ ë°ì´í„°ì™€ ë™ê¸°í™” ë˜ë„ë¡ ìœ ì§€í•˜ê³  ì‹¶ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤.

ë³€í˜•(mutation)ì˜ ê²½ìš° ì´ëŸ¬í•œ ë°©ì‹ì€ ìž˜ ìž‘ë™í•˜ì§€ ì•Šì„ ê²ƒìž…ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì°½ì— í¬ì»¤ìŠ¤ê°€ ë§žì¶°ì§ˆ ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ í•  ì¼ì´ ìƒì„±ëœë‹¤ê³  ìƒìƒí•´ë³´ì„¸ìš” ðŸ¤¨. ê·¸ëž˜ì„œ ë³€í˜•ì„ ì¦‰ì‹œ ì‹¤í–‰í•˜ëŠ” ëŒ€ì‹ , React QueryëŠ” ë³€í˜•ì„ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œë§ˆë‹¤ í˜¸ì¶œí•  ìˆ˜ ìžˆëŠ” í•¨ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

```tsx
// imperative-mutate

function AddComment({ id }) {
  // ì•„ì§ ì•„ë¬´ê²ƒë„ ì‹¤í–‰í•˜ì§€ ì•Šì„ ê²ƒìž…ë‹ˆë‹¤.
  const addComment = useMutation({
    mutationFn: (newComment) => axios.post(`/posts/${id}/comments`, newComment),
  });

  return (
    <form
      onSubmit={(event) => {
        event.preventDefault();
        // âœ… mutationì€ í¼ì´ ì œì¶œë˜ë©´ ì‹¤í–‰ë©ë‹ˆë‹¤.
        addComment.mutate(new FormData(event.currentTarget).get('comment'));
      }}>
      <textarea name="comment" />
      <button type="submit">Comment</button>
    </form>
  );
}
```

ë˜ ë‹¤ë¥¸ ì°¨ì´ì ì€ ë³€í˜•(mutation)ì´ `useQuery`ì²˜ëŸ¼ ìƒíƒœë¥¼ ê³µìœ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒìž…ë‹ˆë‹¤. ì„œë¡œ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ `useQuery` ë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•  ìˆ˜ ìžˆê³ , ë™ì¼í•œ ìºì‹œëœ ê²°ê³¼ë¥¼ ë°˜í™˜ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤ - í•˜ì§€ë§Œ ì´ê²ƒì€ ë³€í˜•ì—ëŠ” ì ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

> **ì—…ë°ì´íŠ¸ (Update)**
>
> v5ë¶€í„° [useMutationState](https://tanstack.com/query/v5/docs/framework/react/reference/useMutationState) í›…ì„ ì‚¬ìš©í•´ì„œ ë³€í˜•(mutation)ì˜ ìƒíƒœë¥¼ ì»´í¬ë„ŒíŠ¸ ê°„ì— ê³µìœ í•  ìˆ˜ ìžˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ë³€í˜•(mutation)ì„ ì¿¼ë¦¬ì™€ ì—°ê²°í•˜ê¸° (Tying mutations to queries)

ë³€í˜•(mutation)ì€ ì„¤ê³„ìƒ ì¿¼ë¦¬ì™€ ì§ì ‘ ì—°ê²°ë˜ì–´ ìžˆì§€ ì•ŠìŠµë‹ˆë‹¤. ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì˜ ì¢‹ì•„ìš”ë¥¼ ë‹´ë‹¹í•˜ëŠ” ë³€í˜•ì€ í•´ë‹¹ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬ì™€ ì•„ë¬´ëŸ° ê´€ë ¨ì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë ¨ì´ ìžˆìœ¼ë ¤ë©´, React Queryê°€ ê°€ì§€ê³  ìžˆì§€ ì•Šì€ ì–´ë–¤ ì¢…ë¥˜ì˜ ê¸°ë³¸ ìŠ¤í‚¤ë§ˆê°€ í•„ìš”í•  ê²ƒìž…ë‹ˆë‹¤.

ë³€í˜•ìœ¼ë¡œ ì¸í•œ ë³€ê²½ì‚¬í•­ì„ ì¿¼ë¦¬ì— ë°˜ì˜í•˜ê¸° ìœ„í•´, React QueryëŠ” ì£¼ë¡œ ë‘ ê°€ì§€ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤:

### ë¬´íš¨í™” (Invalidation)

ì´ëŠ” í™”ë©´ì„ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ê°€ìž¥ ê°„ë‹¨í•œ ë°©ë²•ìž…ë‹ˆë‹¤. ì„œë²„ ìƒíƒœì™€ í•¨ê»˜ë¼ë©´, ë‹¹ì‹ ì´ í‘œì‹œí•˜ëŠ” ê²ƒì€ í•´ë‹¹ ì‹œì ì˜ ë°ì´í„°ì˜ ìŠ¤ëƒ…ìƒ·ì¼ ë¿ìž„ì„ ê¸°ì–µí•˜ì„¸ìš”. ë¬¼ë¡  React QueryëŠ” ê·¸ ë°ì´í„°ë¥¼ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•˜ë ¤ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë³€í˜•(mutation)ì„ í†µí•´ ì˜ë„ì ìœ¼ë¡œ ì„œë²„ ìƒíƒœë¥¼ ë³€ê²½í•œë‹¤ë©´, ì´ëŠ” React Queryì—ê²Œ ìºì‹œëœ ì¼ë¶€ ë°ì´í„°ê°€ ì´ì œ â€œë¬´íš¨â€í•˜ë‹¤ê³  ì•Œë¦´ ì¢‹ì€ ì‹œì ìž…ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ React QueryëŠ” í˜„ìž¬ ì‚¬ìš© ì¤‘ì¸ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê³ , ë¶ˆëŸ¬ì˜¤ê¸°ê°€ ì™„ë£Œë˜ë©´ í™”ë©´ì´ ìžë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ê²ŒëŠ” ë‹¨ì§€ _ì–´ë–¤_ ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”í•˜ê³  ì‹¶ì€ì§€ë§Œ ì•Œë ¤ì£¼ë©´ ë©ë‹ˆë‹¤.

```tsx
// invalidation-from-mutation

const useAddComment = (id) => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (newComment) => axios.post(`/posts/${id}/comments`, newComment),
    onSuccess: () => {
      // âœ… ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì˜ ëŒ“ê¸€ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
      queryClient.invalidateQueries({
        queryKey: ['posts', id, 'comments'],
      });
    },
  });
};
```

ì¿¼ë¦¬ ë¬´íš¨í™”ëŠ” ê½¤ ë˜‘ë˜‘í•©ë‹ˆë‹¤. ëª¨ë“  [ì¿¼ë¦¬ í•„í„°](https://react-query.tanstack.com/guides/filters#query-filters)ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, ì¿¼ë¦¬ í‚¤ì— ëŒ€í•´ í¼ì§€ ë§¤ì¹­(fuzzy matching)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì—¬ëŸ¬ë¶„ì´ ëŒ“ê¸€ ëª©ë¡ì— ëŒ€í•´ ì—¬ëŸ¬ í‚¤ë¥¼ ê°€ì§€ê³  ìžˆë‹¤ë©´, ê·¸ ëª¨ë“  ê²ƒë“¤ì´ ë¬´íš¨í™”ë  ê²ƒìž…ë‹ˆë‹¤. í•˜ì§€ë§Œ, í˜„ìž¬ í™œì„±í™”ëœ ê²ƒë“¤ë§Œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. ë‚˜ë¨¸ì§€ëŠ” ì˜¤ëž˜ë˜ì—ˆë‹¤ê³ (stale) í‘œì‹œë˜ë©°, ë‹¤ìŒì— ì‚¬ìš©ë  ë•Œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê²Œ ë©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ìš°ë¦¬ê°€ ëŒ“ê¸€ì„ ì •ë ¬í•  ìˆ˜ ìžˆëŠ” ì˜µì…˜ì„ ê°€ì§€ê³  ìžˆê³ , ìƒˆ ëŒ“ê¸€ì´ ì¶”ê°€ëœ ì‹œì ì—ì„œ ìš°ë¦¬ì˜ ìºì‹œì—ëŠ” ë‘ ê°œì˜ ëŒ“ê¸€ ì¿¼ë¦¬ê°€ ìžˆë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤:

```tsx
['posts', 5, 'comments', { sortBy: ['date', 'asc'] }
['posts', 5, 'comments', { sortBy: ['author', 'desc'] }
```

ìš°ë¦¬ëŠ” ì´ ì¤‘ í•˜ë‚˜ë§Œì„ í™”ë©´ì— ë³´ì—¬ì£¼ê³  ìžˆê¸° ë•Œë¬¸ì—, `invalidateQueries`ëŠ” í•´ë‹¹ ì¿¼ë¦¬ë§Œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê³  ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ì˜¤ëž˜ë˜ì—ˆë‹¤ê³  í‘œì‹œí•  ê²ƒìž…ë‹ˆë‹¤.

### ì§ì ‘ ì—…ë°ì´íŠ¸ (Direct updates)

ë•Œë¡œëŠ”, íŠ¹ížˆ ë³€í˜•(mutation) ì´í›„ì— í•„ìš”í•œ ëª¨ë“  ê²ƒì´ ì´ë¯¸ ë°˜í™˜ëœ ê²½ìš°ì—ëŠ” ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê³  ì‹¶ì§€ ì•Šì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì˜ ì œëª©ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë³€í˜•ì´ ìžˆê³  ë°±ì—”ë“œê°€ ì™„ì „í•œ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ê²½ìš°, `setQueryData`ë¥¼ í†µí•´ ì¿¼ë¦¬ ìºì‹œë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```tsx
// update-from-mutation-response

const useUpdateTitle = (id) => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (newTitle) => axios.patch(`/posts/${id}`, { title: newTitle }).then((response) => response.data),
    // ðŸ’¡ ë³€í˜• (mutation)ì˜ ì‘ë‹µì´ onSucessë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
    onSuccess: (newPost) => {
      // âœ… ìƒì„¸ë³´ê°€ í™”ë©´ì„ ì§ì ‘ ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤.
      queryClient.setQueryData(['posts', id], newPost);
    },
  });
};
```

`setQueryData`ë¥¼ í†µí•´ ì§ì ‘ ìºì‹œì— ë°ì´í„°ë¥¼ ë„£ëŠ” ê²ƒì€ ì´ ë°ì´í„°ê°€ ë°±ì—”ë“œì—ì„œ ë°˜í™˜ëœ ê²ƒì²˜ëŸ¼ ìž‘ë™í•  ê²ƒì´ë©°, ê·¸ì— ë”°ë¼ í•´ë‹¹ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ê²ƒìž„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì§ì ‘ ì—…ë°ì´íŠ¸ì™€ ë‘ ì ‘ê·¼ ë°©ì‹ì˜ ì¡°í•©ì— ëŒ€í•œ ë” ë§Žì€ ì˜ˆì‹œëŠ” [#8: Effective React Query Keys](https://tkdodo.eu/blog/effective-react-query-keys#structure)ì—ì„œ ë‹¤ë£¨ê³  ìžˆìŠµë‹ˆë‹¤.

---

ê°œì¸ì ìœ¼ë¡œ, ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì— ë¬´íš¨í™”ë¥¼ ì„ í˜¸í•´ì•¼ í•œë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ë¬¼ë¡ , ì‚¬ìš© ì‚¬ë¡€ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ, ì§ì ‘ ì—…ë°ì´íŠ¸ê°€ ì‹ ë¢°ì„± ìžˆê²Œ ìž‘ë™í•˜ë ¤ë©´ í”„ë¡ íŠ¸ì—”ë“œì— ë” ë§Žì€ ì½”ë“œê°€ í•„ìš”í•˜ë©° ì–´ëŠ ì •ë„ ë°±ì—”ë“œì˜ ë¡œì§ê³¼ ì¤‘ë³µëœ ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì •ë ¬ëœ ëª©ë¡ì€ ì§ì ‘ ì—…ë°ì´íŠ¸í•˜ê¸°ê°€ ê½¤ ì–´ë µìŠµë‹ˆë‹¤. ì—…ë°ì´íŠ¸ë¡œ ì¸í•´ ë‚´ í•­ëª©ì˜ ìœ„ì¹˜ê°€ ë³€ê²½ë˜ì—ˆì„ ìˆ˜ ìžˆê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤. ëª©ë¡ ì „ì²´ë¥¼ ë¬´íš¨í™”í•˜ëŠ” ê²ƒì´ â€œë” ì•ˆì „í•œâ€ ì ‘ê·¼ ë°©ë²•ìž…ë‹ˆë‹¤.

## ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (Optimistic updates)

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ëŠ” React Query ë³€í˜•(mutation)ì„ ì‚¬ìš©í•˜ëŠ” ì£¼ìš” ìž¥ì  ì¤‘ í•˜ë‚˜ìž…ë‹ˆë‹¤. _useQuery_ ìºì‹œëŠ” ì¿¼ë¦¬ ê°„ì˜ ì „í™˜ ì‹œ, íŠ¹ížˆ [ë°ì´í„° ë¯¸ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°(prefetching)](https://react-query.tanstack.com/guides/prefetching)ì™€ ê°™ì´ ì‚¬ìš©í•  ë•Œ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ì œê³µí•©ë‹ˆë‹¤. ì´ ë•ë¶„ì— ì „ì²´ì ì¸ UIê°€ ë§¤ìš° ë¹ ë¥´ê²Œ ëŠê»´ì§‘ë‹ˆë‹¤. ë³€í˜•(mutation)ì—ë„ ê°™ì€ ì´ì ì„ ì–»ì„ ìˆ˜ ìžˆë‹¤ë©´ ì–´ë–¨ê¹Œìš”?

ëŒ€ë¶€ë¶„ì˜ ê²½ìš°, ìš°ë¦¬ëŠ” ì—…ë°ì´íŠ¸ê°€ ì„±ê³µí•  ê²ƒì´ë¼ê³  í™•ì‹ í•©ë‹ˆë‹¤. ë°±ì—”ë“œë¡œë¶€í„° okë¥¼ ë°›ê³  UIì— ê²°ê³¼ë¥¼ í‘œì‹œí•˜ê¸°ê¹Œì§€ ëª‡ ì´ˆë¥¼ ì‚¬ìš©ìžê°€ ì™œ ê¸°ë‹¤ë ¤ì•¼ í• ê¹Œìš”? ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì˜ ì•„ì´ë””ì–´ëŠ” ì„œë²„ë¡œ ì „ì†¡í•˜ê¸° ì „ì— ë³€í˜•(mutation)ì˜ ì„±ê³µì„ ê°€ì •í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ì„±ê³µì ì¸ ì‘ë‹µì„ ë°›ê²Œ ë˜ë©´, ìš°ë¦¬ê°€ í•´ì•¼ í•  ì¼ì€ í™”ë©´ì„ ë‹¤ì‹œ ë¬´íš¨í™”í•˜ì—¬ ì‹¤ì œ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒìž…ë‹ˆë‹¤. ìš”ì²­ì´ ì‹¤íŒ¨í•  ê²½ìš°, ìš°ë¦¬ëŠ” UIë¥¼ ë³€í˜• ì´ì „ì˜ ìƒíƒœë¡œ ë¡¤ë°±í•  ê²ƒìž…ë‹ˆë‹¤.

ì´ ë°©ë²•ì€ ì¦‰ê°ì ì¸ ì‚¬ìš©ìž í”¼ë“œë°±ì´ í•„ìš”í•œ ìž‘ì€ ë³€í˜•(mutation)ì— ëŒ€í•´ í›Œë¥­í•˜ê²Œ ìž‘ë™í•©ë‹ˆë‹¤. ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” í† ê¸€ ë²„íŠ¼ì´ ìžˆê³ , ìš”ì²­ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ì „í˜€ ë°˜ì‘í•˜ì§€ ì•ŠëŠ” ê²ƒë³´ë‹¤ ë” ë‚˜ìœ ê²ƒì€ ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš©ìžë“¤ì€ ê·¸ ë²„íŠ¼ì„ ë‘ ë²ˆì´ë‚˜ ì„¸ ë²ˆ í´ë¦­í•  ê²ƒì´ê³ , ëª¨ë“  ê³³ì—ì„œ "ëŠë¦¬ë‹¤ê³ " ëŠê»´ì§ˆ ê²ƒìž…ë‹ˆë‹¤.

### ì˜ˆì‹œ (Example)

ì¶”ê°€ì ì¸ ì˜ˆì‹œë¥¼ ë³´ì—¬ë“œë¦¬ì§€ëŠ” _ì•Šì„ ê²ƒìž…ë‹ˆë‹¤_. [ê³µì‹ ë¬¸ì„œ](https://react-query.tanstack.com/guides/optimistic-updates)ì—ì„œ í•´ë‹¹ í† í”½ì„ í›Œë¥­í•˜ê²Œ ë‹¤ë£¨ê³  ìžˆê³ , [íƒ€ìž…ìŠ¤í¬ë¦½íŠ¸](https://tanstack.com/query/v4/docs/examples/react/optimistic-updates-typescript)ë¡œ ìž‘ì„±ëœ codesandbox ì˜ˆì‹œë„ ìžˆìŠµë‹ˆë‹¤.

ì €ëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ê°€ ë‹¤ì†Œ ê³¼ë„í•˜ê²Œ ì‚¬ìš©ëœë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ëª¨ë“  ë³€í˜•(mutation)ì„ ë‚™ê´€ì ìœ¼ë¡œ ìˆ˜í–‰í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ì‹¤íŒ¨í•  í™•ë¥ ì´ ë§¤ìš° ë“œë¬¼ë‹¤ëŠ” ê²ƒì„ ì •ë§ í™•ì‹ í•  ë•Œì—ë§Œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ë¡¤ë°±ì— ëŒ€í•œ UXëŠ” ê·¸ë¦¬ ì¢‹ì§€ ì•Šê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ì œì¶œí•  ë•Œ ë‹«ížˆëŠ” ëª¨ë‹¬ íŒì—… ë‚´ë¶€ì˜ í¼ì´ë‚˜, ì—…ë°ì´íŠ¸ í›„ ìƒì„¸ í™”ë©´ì—ì„œ ë¦¬ìŠ¤íŠ¸ í™”ë©´ìœ¼ë¡œì˜ ë¦¬ë‹¤ì´ë ‰ì…˜ì´ ìžˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë™ìž‘ë“¤ì´ ì„±ê¸‰í•˜ê²Œ ìˆ˜í–‰ë˜ë©´, ë‹¤ì‹œ ë˜ëŒë¦¬ê¸°ê°€ ì–´ë µìŠµë‹ˆë‹¤.

ë˜í•œ, ì¦‰ê°ì ì¸ í”¼ë“œë°±ì´ ì •ë§ í•„ìš”í•œ ê²ƒì¸ì§€ë¥¼ ê¼­ í™•ì¸í•˜ì„¸ìš” (ìœ„ì˜ í† ê¸€ ë²„íŠ¼ ì˜ˆì œì²˜ëŸ¼). ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ìž‘ë™ì‹œí‚¤ëŠ” ë° í•„ìš”í•œ ì½”ë“œëŠ” ê°„ë‹¨í•˜ì§€ ì•Šìœ¼ë©°, "í‘œì¤€ì ì¸" ë³€í˜•(mutation)ê³¼ ë¹„êµí•˜ë©´ íŠ¹ížˆ ë” ê·¸ë ‡ìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ ê°€ì •í•´ì„œ ë³´ì—¬ì£¼ë ¤ë©´ ë°±ì—”ë“œê°€ í•˜ëŠ” ì¼ì„ ëª¨ë°©í•´ì•¼ í•˜ë©°, ì´ëŠ” Booleanì„ ë’¤ì§‘ê±°ë‚˜ ë°°ì—´ì— í•­ëª©ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì‰¬ìš¸ ìˆ˜ ìžˆì§€ë§Œ, ë¹ ë¥¸ ì†ë„ë¡œ ë³µìž¡í•´ì§ˆ ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤:

- ì¶”ê°€í•˜ëŠ” í•  ì¼ì— idê°€ í•„ìš”í•˜ë‹¤ë©´, ì–´ë””ì„œ ê°€ì ¸ì˜¤ì‹œê² ì–´ìš”?
- í˜„ìž¬ ë³´ê³  ìžˆëŠ” ë¦¬ìŠ¤íŠ¸ê°€ ì •ë ¬ë˜ì–´ ìžˆë‹¤ë©´, ìƒˆë¡œìš´ í•­ëª©ì„ ì˜¬ë°”ë¥¸ ìœ„ì¹˜ì— ì‚½ìž…í•˜ì‹œë‚˜ìš”?
- ë‹¤ë¥¸ ì‚¬ìš©ìžê°€ ê·¸ ì‚¬ì´ì— ë‹¤ë¥¸ ê²ƒì„ ì¶”ê°€í–ˆë‹¤ë©´, ë‚™ê´€ì ìœ¼ë¡œ ì¶”ê°€ëœ í•­ëª©ì˜ ìœ„ì¹˜ê°€ ìž¬ìš”ì²­ í›„ì— ë°”ë€Œë‚˜ìš”?

ì´ëŸ¬í•œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ëŠ” ì¼ë¶€ ìƒí™©ì—ì„œ UXë¥¼ ì‹¤ì œë¡œ ë” ë‚˜ì˜ê²Œ ë§Œë“¤ ìˆ˜ ìžˆìœ¼ë©°, ì˜¤ížˆë ¤ ë³€í˜•(mutation)ì´ ì§„í–‰ ì¤‘ì¼ ë•Œ ë²„íŠ¼ì„ ë¹„í™œì„±í™”í•˜ê³  ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ì„ ì¶œë ¥í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ì¶©ë¶„í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì–¸ì œë‚˜ ê·¸ë ‡ë“¯, ì˜¬ë°”ë¥¸ ë„êµ¬ë¥¼ ì˜¬ë°”ë¥¸ ìž‘ì—…ì— ì‚¬ìš©í•˜ì„¸ìš”.

## í”í•œ ê°“ì±  (Common Gotchas)

ë§ˆì§€ë§‰ìœ¼ë¡œ, ë³€í˜•ì„ ë‹¤ë£° ë•Œ ì¤‘ìš”í•˜ì§€ë§Œ ì²˜ìŒì—ëŠ” ê·¸ë¦¬ ëª…í™•í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìžˆëŠ” ëª‡ ê°€ì§€ ì‚¬í•­ë“¤ì„ ì‚´íŽ´ë³´ê² ìŠµë‹ˆë‹¤:

### ëŒ€ê¸°ì¤‘ì¸ í”„ë¡œë¯¸ìŠ¤ (awaited Promises)

ë³€í˜• ì½œë°±ì—ì„œ ë°˜í™˜ëœ í”„ë¡œë¯¸ìŠ¤ëŠ” React Queryì— ì˜í•´ ëŒ€ê¸°(awaited) ìƒíƒœê°€ ë˜ë©°, `invalidateQueries`ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ê´€ë ¨ëœ ì¿¼ë¦¬ê°€ ì—…ë°ì´íŠ¸í•˜ëŠ” ë™ì•ˆ ë³€í˜•(mutation)ì´ `loading` ìƒíƒœì— ë¨¸ë¬¼ê¸¸ ì›í•œë‹¤ë©´, ì½œë°±ì—ì„œ `invalidateQueries`ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤:

```tsx
// awaited-promises

{
  // ðŸŽ‰ ì¿¼ë¦¬ ë¬´íš¨í™”ê°€ ëë‚  ë•Œ ê¹Œì§€ ëŒ€ê¸°í•  ê²ƒìž…ë‹ˆë‹¤.
  onSuccess: () => {
    return queryClient.invalidateQueries({
      queryKey: ['posts', id, 'comments'],
    });
  };
}
{
  // ðŸš€ ì‹¤í–‰í•˜ê³  ëìž…ë‹ˆë‹¤. - ëŒ€ê¸°í•˜ì§€ ì•Šì„ ê²ƒìž…ë‹ˆë‹¤.
  onSuccess: () => {
    queryClient.invalidateQueries({
      queryKey: ['posts', id, 'comments'],
    });
  };
}
```

### Mutate ë˜ëŠ” MutateAsync (Mutate or MutateAsync)

`useMutation`ì€ ë‘ ê°€ì§€ í•¨ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤ - `mutate`ì™€ `mutateAsync`. ì´ ë‘˜ì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì´ë©°, ì–¸ì œ ì–´ëŠ ê²ƒì„ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?

`mutate`ëŠ” ì•„ë¬´ ê²ƒë„ ë°˜í™˜í•˜ì§€ ì•ŠëŠ” ë°˜ë©´, `mutateAsync`ëŠ” ë³€í˜•ì˜ ê²°ê³¼ë¥¼ í¬í•¨í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ê·¸ëž˜ì„œ ë³€í˜• ì‘ë‹µì— ì ‘ê·¼í•´ì•¼ í•  ë•Œ `mutateAsync`ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ìˆ˜ ìžˆì§€ë§Œ, ì €ëŠ” ê±°ì˜ í•­ìƒ `mutate`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ê³  ì£¼ìž¥í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤.

ì½œë°±ì„ í†µí•´ `data`ë‚˜ `error`ì— ì—¬ì „ížˆ ì ‘ê·¼í•  ìˆ˜ ìžˆìœ¼ë©°, ì˜¤ë¥˜ ì²˜ë¦¬ì— ëŒ€í•´ ê±±ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. `mutateAsync`ëŠ” í”„ë¡œë¯¸ìŠ¤ ì œì–´ê¶Œì„ ê°œë°œìžì—ê²Œ ë„˜ê¸°ê¸° ë•Œë¬¸ì—, ìˆ˜ë™ìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ìž¡ì•„ì•¼ í•˜ë©°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ [ì²˜ë¦¬ë˜ì§€ ì•Šì€ í”„ë¡œë¯¸ìŠ¤ ê±°ë¶€](https://stackoverflow.com/questions/40500490/what-is-an-unhandled-promise-rejection)ë¥¼ ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```tsx
// accessing-mutation-data

const onSubmit = () => {
  // âœ… onSuccessë¥¼ í†µí•´ ì‘ë‹µì— ì ‘ê·¼í•©ë‹ˆë‹¤.
  myMutation.mutate(someData, {
    onSuccess: (data) => history.push(data.url),
  });
};

const onSubmit = async () => {
  // ðŸš¨ ìž‘ë™í•˜ì§€ë§Œ, ì—ëŸ¬ ì²˜ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.
  const data = await myMutation.mutateAsync(someData);
  history.push(data.url);
};

const onSubmit = async () => {
  // ðŸ˜• ë¬¸ì œëŠ” ì—†ëŠ” ë°©ë²•ì´ì§€ë§Œ ìž¥í™©í•©ë‹ˆë‹¤.
  try {
    const data = await myMutation.mutateAsync(someData);
    history.push(data.url);
  } catch (error) {
    // ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  }
};
```

`mutate`ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” React Queryê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ í¬ì°©í•˜ê³  (ê·¸ë¦¬ê³  ë²„ë¦½ë‹ˆë‹¤) ì²˜ë¦¬í•´ì£¼ê¸° ë•Œë¬¸ì—, ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì‹¤ì œë¡œ `mutateAsync().catch(noop)`ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. ðŸ˜Ž

`mutateAsync`ê°€ ë” ìš°ìˆ˜í•œ ìƒí™©ì€ ì •ë§ë¡œ í”„ë¡œë¯¸ìŠ¤ê°€ í•„ìš”í•œ ê²½ìš°ìž…ë‹ˆë‹¤. ì´ëŠ” ì—¬ëŸ¬ ë³€í˜•ì„ ë™ì‹œì— ë°œë™ì‹œí‚¤ê³  ëª¨ë‘ ì™„ë£Œë˜ê¸°ê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  ì‹¶ê±°ë‚˜, ì½œë°±ìœ¼ë¡œ ì¸í•œ ì½œë°± ì§€ì˜¥ì— ë¹ ì§ˆ ìˆ˜ ìžˆëŠ” ì¢…ì†ì ì¸ ë³€í˜•ì´ ìžˆëŠ” ê²½ìš°ì— í•„ìš”í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### ë³€í˜•ì€ ë³€ìˆ˜ì— ëŒ€í•´ í•˜ë‚˜ì˜ ì¸ìžë§Œ ë°›ìŠµë‹ˆë‹¤ (Mutations only take one argument for variables)

`mutate`ì˜ ë§ˆì§€ë§‰ ì¸ìžê°€ ì˜µì…˜ ê°ì²´ì´ê¸° ë•Œë¬¸ì—, `useMutation`ì€ í˜„ìž¬ ë³€ìˆ˜ì— ëŒ€í•´ _í•˜ë‚˜ì˜_ ì¸ìžë§Œ ë°›ì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ í™•ì‹¤ížˆ í•œê³„ì´ì§€ë§Œ, ê°ì²´ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì‰½ê²Œ ìš°íšŒí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤:

```tsx
// multiple-variables

// ðŸš¨ ìž˜ëª»ëœ ë¬¸ë²•ì´ë©° ë™ìž‘í•˜ì§€ ì•Šì„ ê²ƒìž…ë‹ˆë‹¤.
const mutation = useMutation({
  mutationFn: (title, body) => updateTodo(title, body),
});
mutation.mutate('hello', 'world');

// âœ… ë‹¤ìˆ˜ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
const mutation = useMutation({
  mutationFn: ({ title, body }) => updateTodo(title, body),
});
mutation.mutate({ title: 'hello', body: 'world' });
```

ì´ ë°©ì‹ì´ ì™œ í•„ìš”í•œì§€ì— ëŒ€í•´ ë” ì½ê³  ì‹¶ë‹¤ë©´, [ì´ í† ë¡ ](https://github.com/tannerlinsley/react-query/discussions/1226)ì„ í™•ì¸í•´ ë³´ì„¸ìš”.

### ì¼ë¶€ ì½œë°±ì€ ì‹¤í–‰ë˜ì§€ ì•Šì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤ (Some callbacks might not fire)

`useMutation`ê³¼ `mutate` ìžì²´ì— ì½œë°±ì„ ì„¤ì •í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. `useMutation`ì˜ ì½œë°±ì´ `mutate`ì˜ ì½œë°± ì „ì— ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì•Œì•„ë‘ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë˜í•œ, ë³€í˜•(mutation)ì´ ì™„ë£Œë˜ê¸° ì „ì— ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ë©´ `mutate`ì˜ ì½œë°±ì´ _ì „í˜€_ ì‹¤í–‰ë˜ì§€ ì•Šì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

ê·¸ëž˜ì„œ ì½œë°±ì—ì„œ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ì€ ì‹¤ì²œì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.

- ì¿¼ë¦¬ ë¬´íš¨í™”ì™€ ê°™ì´ ë¬´ì¡°ê±´ í•„ìš”í•˜ë©° ë¡œì§ê³¼ ê´€ë ¨ëœ ìž‘ì—…(ì¿¼ë¦¬ ë¬´íš¨í™”ì™€ ê°™ì€)ì€ `useMutation` ì½œë°±ì—ì„œ ìˆ˜í–‰í•˜ì„¸ìš”.
- ë¦¬ë‹¤ì´ë ‰ì…˜ ë˜ëŠ” í† ìŠ¤íŠ¸ ì•Œë¦¼ê³¼ ê°™ì€ UI ê´€ë ¨ ìž‘ì—…ì€ `mutate` ì½œë°±ì—ì„œ ìˆ˜í–‰í•˜ì„¸ìš”. ë³€í˜•ì´ ì™„ë£Œë˜ê¸° ì „ì— ì‚¬ìš©ìžê°€ í˜„ìž¬ í™”ë©´ì—ì„œ ë²—ì–´ë‚¬ë‹¤ë©´, ì´ëŸ¬í•œ ìž‘ì—…ì€ ì˜ë„ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šì„ ê²ƒìž…ë‹ˆë‹¤.

ì´ëŸ¬í•œ ë¶„ë¦¬ëŠ” `useMutation`ì„ ì»¤ìŠ¤í…€ í›…ì—ì„œ ì‚¬ìš©í•  ê²½ìš° íŠ¹ížˆ ê¹”ë”í•©ë‹ˆë‹¤. ì´ëŠ” ì¿¼ë¦¬ ê´€ë ¨ ë¡œì§ì„ ì‚¬ìš©ìž ì •ì˜ í›…ì— ìœ ì§€í•˜ë©´ì„œ UI ê´€ë ¨ ìž‘ì—…ì€ ì—¬ì „ížˆ UIì— ìžˆê²Œ í•©ë‹ˆë‹¤. ì´ëŠ” ë˜í•œ ì»¤ìŠ¤í…€ í›…ì„ ë” ìž¬ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. ì™œëƒí•˜ë©´ UIì™€ ìƒí˜¸ ìž‘ìš©í•˜ëŠ” ë°©ì‹ì€ ì‚¬ë¡€ë³„ë¡œ ë‹¤ë¥¼ ìˆ˜ ìžˆì§€ë§Œ, ë¬´íš¨í™” ë¡œì§ì€ í•­ìƒ ë™ì¼í•  ê°€ëŠ¥ì„±ì´ ë†’ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤:

```tsx
// separate-concerns

const useUpdateTodo = () =>
  useMutation({
    mutationFn: updateTodo,
    // âœ… í•­ìƒ í•  ì¼ ëª©ë¡ì„ ë¬´íš¨í™” í•©ë‹ˆë‹¤.
    onSuccess: () => {
      queryClient.invalidateQueries({
        queryKey: ['todos', 'list'],
      });
    },
  });

// ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€

const updateTodo = useUpdateTodo();
updateTodo.mutate(
  { title: 'newTitle' },
  // âœ… ë³€í˜• (mutation)ì´ ëë‚¬ì„ ë•Œ ìš°ë¦¬ê°€ ì—¬ì „ížˆ
  // ìƒì„¸ íŽ˜ì´ì§€ì— ìœ„ì¹˜í•´ìžˆì„ ë•Œì—ë§Œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•  ê²ƒìž…ë‹ˆë‹¤.
  { onSuccess: () => history.push('/todos') },
);
```

---
