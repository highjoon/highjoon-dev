---
title: (ë²ˆì—­) Testing React Query
date: 2024-01-09
description: Testing React Query ë²ˆì—­
---

## Table of Contents

## ë³¸ë¬¸

> [TkDodo](https://github.com/tkdodo)ì˜ [Testing React Query](https://tkdodo.eu/blog/testing-react-query)ë¥¼ ë²ˆì—­í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

React Queryì™€ í•¨ê»˜ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì£¼ì œë¡œ ì§ˆë¬¸ì´ ê½¤ ë§ì´ ì˜¬ë¼ì˜¤ë¯€ë¡œ ì´ë²ˆ ì•„í‹°í´ì—ì„œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì§ˆë¬¸ì´ ì˜¬ë¼ì˜¤ëŠ” ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ” â€œë˜‘ë˜‘í•œâ€ ì»´í¬ë„ŒíŠ¸ (ë˜ëŠ” [ì»¨í…Œì´ë„ˆ ì»´í¬ë„ŒíŠ¸](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0)ë¼ê³  ë¶ˆë¦¬ìš°ëŠ”)ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì€ ì‰¬ìš´ ì¼ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. hooksê°€ ë“±ì¥í•˜ë©´ì„œ ì´ëŸ° ì‹ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ ê±°ì˜ íê¸°ë˜ì—ˆìŠµë‹ˆë‹¤. ì„ì˜ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‚˜ëˆˆ í›„ propsë¥¼ ë‚´ë ¤ì£¼ëŠ” ëŒ€ì‹ ì—, ì´ì œëŠ” íŠ¹ì • ìœ„ì¹˜ì—ì„œ í›…ì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ê¶Œì¥ë˜ê³  ìˆìŠµë‹ˆë‹¤.

ì €ëŠ” ì´ ë°©ì‹ì´ ê³µê°„ ë°°ì¹˜ ë° ì½”ë“œ ê°€ë…ì„± ê´€ì ì—ì„œ ëŒ€ì²´ë¡œ ì•„ì£¼ ì¢‹ì€ ê°œì„ ì´ë¼ê³  ìƒê°í•˜ì§€ë§Œ, ì´ì œëŠ” â€œê·¸ì € propsâ€ê°€ ì•„ë‹Œ ì˜ì¡´ì„±ì„ ì†Œë¹„í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë§ì•„ì¡ŒìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì˜ì¡´ì„±ì€ `useContext`ê°€ ë  ìˆ˜ ìˆê³ , `useSelector`ê°€ ë  ìˆ˜ ìˆìœ¼ë©°, `useQuery`ë„ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì»´í¬ë„ŒíŠ¸ëŠ” ê¸°ìˆ ì ìœ¼ë¡œ ë”ì´ìƒ ìˆœìˆ˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ë‹¤ë¥¸ í™˜ê²½ì—ì„œ í˜¸ì¶œí•˜ë©´ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ê²ƒì´ê¸° ë•Œë¬¸ì´ì£ . ì´ëŸ¬í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì œëŒ€ë¡œ ë™ì‘í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ ì£¼ë³€ í™˜ê²½ì„ ì‹ ì¤‘í•˜ê²Œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

## ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ëª¨í‚¹ (Mocking network requests)

React QueryëŠ” ë¹„ë™ê¸° ì„œë²„ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ë°±ì—”ë“œì— ìš”ì²­ì„ ë³´ë‚¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” ë°±ì—”ë“œê°€ ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ê°€ëŠ¥í•˜ë‹¤ê³  í•˜ë”ë¼ë„ ì—¬ëŸ¬ë¶„ì€ í…ŒìŠ¤íŠ¸ê°€ ë°±ì—”ë“œì— ì˜ì¡´ì„±ì„ ê°–ëŠ” ê²ƒì„ ì›í•˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

jestë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ëª¨í‚¹í•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¨ëŠ” ì•„í‹°í´ì€ ì •ë§ ë§ìŠµë‹ˆë‹¤. api í´ë¼ì´ì–¸íŠ¸ë¥¼ ê°–ê³  ìˆë‹¤ë©´ ëª¨í‚¹í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. fetchë‚˜ axiosë¥¼ ì§ì ‘ ëª¨í‚¹í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì €ëŠ” Kent C. Doddsê°€ ê·¸ì˜ ì•„í‹°í´ì¸ [Stop mocking fetch](https://kentcdodds.com/blog/stop-mocking-fetch)ì—ì„œ ì‘ì„±í•œ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì— í¬ê²Œ ë™ì˜í•©ë‹ˆë‹¤.

[@ApiMocking](https://twitter.com/ApiMocking)ì˜ mock service workerë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

apië¥¼ ëª¨í‚¹í•˜ë©´ ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì› (single source of truth)ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë…¸ë“œì—ì„œ ì‘ë™í•©ë‹ˆë‹¤.
- REST ë° GraphQLì„ ì§€ì›í•©ë‹ˆë‹¤.
- `useQuery`ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŠ¤í† ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆëŠ” [storybook addon](https://storybook.js.org/addons/msw-storybook-addon)ì´ ìˆìŠµë‹ˆë‹¤.
- ë¸Œë¼ìš°ì €ì—ì„œ ì‘ë™í•˜ë©° ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ ìš”ì²­ì´ ì§„í–‰ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- cypressì˜ fixturesì™€ ìœ ì‚¬í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤.

---

ë„¤íŠ¸ì›Œí¬ ë ˆì´ì–´ê°€ ê´€ë¦¬ë˜ì—ˆìœ¼ë¯€ë¡œ ì´ì œ React Queryì—ì„œ ì£¼ì˜í•´ì•¼ í•  ì‚¬í•­ì— ëŒ€í•´ ì´ì•¼ê¸°ë¥¼ í•  ìˆ˜ ìˆê² ë„¤ìš”.
React Queryë¥¼ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ QueryClientProviderê°€ í•„ìš”í•˜ë©° queryClientë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤. queryClientëŠ” `QueryCache`ë¥¼ ê°–ê³  ìˆëŠ” ë³´ê´€í•¨ì…ë‹ˆë‹¤. ìºì‹œëŠ” ê°ê°ì˜ ì¿¼ë¦¬ ë°ì´í„°ë¥¼ ë³´ìœ í•˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

ì €ëŠ” ê°ê°ì˜ í…ŒìŠ¤íŠ¸ ë³„ë¡œ QueryClientProviderë¥¼ ì œê³µí•˜ê³  `new QueryClient`ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ëŠ” ì™„ë²½í•˜ê²Œ ë…ë¦½ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œëŠ” ê°ê°ì˜ í…ŒìŠ¤íŠ¸ ì´í›„ì— ìºì‹œë¥¼ ì§€ìš°ëŠ” ë°©ì‹ë„ ìˆê² ì§€ë§Œ, ì €ëŠ” í…ŒìŠ¤íŠ¸ ê°„ì— ìƒíƒœë¥¼ ê³µìœ í•˜ëŠ” ê²ƒì„ ê°€ëŠ¥í•˜ë‹¤ë©´ ìµœì†Œí™”í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ í…ŒìŠ¤íŠ¸ë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰í•  ë•Œ ì˜ˆìƒì¹˜ ëª»í•œ ê²°ê³¼ì™€ ë¶€ì •í™•í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì»¤ìŠ¤í…€ í›…ì˜ ê²½ìš° (For custom hooks)

ì»¤ìŠ¤í…€ í›…ì„ í…ŒìŠ¤íŠ¸í•œë‹¤ë©´ [react-hooks-testing-library](https://react-hooks-testing-library.com/)ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë¼ê³  ê½¤ í™•ì‹ í•©ë‹ˆë‹¤. ê°€ì¥ ì‰½ê²Œ í›…ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ìˆ˜ë‹¨ì´ì£ . ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ í›…ì„ [wrapper](https://react-hooks-testing-library.com/reference/api#wrapper)ë¡œ ê°ìŒ€ ìˆ˜ ìˆìŠµë‹ˆë‹¤. wrapperëŠ” ë Œë”ë§í•  ë•Œ í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ëŠ” React ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. ì €ëŠ” ì´ wrapperê°€ QueryClientë¥¼ ìƒì„±í•˜ê¸°ì— ì™„ë²½í•œ ê³³ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```tsx
// wrapper

const createWrapper = () => {
  // âœ… ê°ê°ì˜ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ìƒˆë¡œìš´ QueryClientë¥¼ ìƒì„±
  const queryClient = new QueryClient();
  return ({ children }) => <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;
};

test('my first test', async () => {
  const { result } = renderHook(() => useCustomHook(), {
    wrapper: createWrapper(),
  });
});
```

### ì»´í¬ë„ŒíŠ¸ì˜ ê²½ìš° (For components)

`useQuery` í›…ì„ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´, ê·¸ ì»´í¬ë„ŒíŠ¸ë¥¼ QueryClientProviderë¡œ ê°ì‹¸ì•¼ í•©ë‹ˆë‹¤. [react-testing-library](https://testing-library.com/docs/react-testing-library/intro/)ì˜ `render` ì£¼ë³€ì— ì‘ì€ wrapperë¥¼ ë§Œë“œëŠ” ê²Œ ì¢‹ì€ ì„ íƒì§€ì¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤. React Queryê°€ [ìì²´ í…ŒìŠ¤íŠ¸](https://github.com/tannerlinsley/react-query/blob/ead2e5dd5237f3d004b66316b5f36af718286d2d/src/react/tests/utils.tsx#L6-L17)ì—ì„œ í•˜ëŠ” ë°©ì‹ì„ ì‚´í´ë³´ì„¸ìš”.

## ì¬ì‹œë„ ê¸°ëŠ¥ì„ ë¹„í™œì„±í™” í•˜ì„¸ìš” (Turn off retries)

ì¬ì‹œë„ ê¸°ëŠ¥ì€ React Queryì™€ í…ŒìŠ¤íŠ¸ì—ì„œ ê°€ì¥ í”í•œ â€œê°“ì± â€ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. React QueryëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì§€ìˆ˜ ë°±ì˜¤í”„ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ ë²ˆì˜ ì¬ì‹œë„ë¥¼ ìˆ˜í–‰í•˜ë¯€ë¡œ ì˜¤ë¥˜ê°€ ìˆëŠ” ì¿¼ë¦¬ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë©´ ì‹œê°„ ì´ˆê³¼ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì¬ì‹œë„ ê¸°ëŠ¥ì„ ë¹„í™œì„±í™”í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€, ë‹¤ì‹œ ê°•ì¡°í•˜ì§€ë§Œ, `QueryClientProvider`ë¥¼ í†µí•´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì˜ ì˜ˆì œë¥¼ í™•ì¥í•´ë´…ì‹œë‹¤.

```tsx
// no-retries

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        // âœ… ì¬ì‹œë„ ê¸°ëŠ¥ì„ ë¹„í™œì„±í™”
        retry: false,
      },
    },
  });

  return ({ children }) => <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;
};

test('my first test', async () => {
  const { result } = renderHook(() => useCustomHook(), {
    wrapper: createWrapper(),
  });
});
```

ì´ë ‡ê²Œí•˜ë©´ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ ìƒì— ìˆëŠ” ëª¨ë“  ì¿¼ë¦¬ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ â€œì¬ì‹œë„ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”â€ë  ê²ƒì…ë‹ˆë‹¤. ì´ ë°©ì‹ì€ `useQuery`ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ì¬ì‹œë„ ê¸°ëŠ¥ì´ ì„¤ì •ë˜ì§€ ì•Šì„ ê²½ìš°ì—ë§Œ ì‘ë™í•œë‹¤ëŠ” ê²ƒì„ ê¼­ ì•Œì•„ì•¼í•©ë‹ˆë‹¤. 5ë²ˆì˜ ì¬ì‹œë„ë¥¼ ì›í•˜ëŠ” ì¿¼ë¦¬ê°€ ìˆë‹¤ë©´ ë” ìš°ì„ ì ìœ¼ë¡œ ì ìš©ë  ê²ƒì…ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ê¸°ë³¸ ì„¤ì •ì€ ì˜¤ì§ ëŒ€ì²´ì œë¡œ ì‚¬ìš©ë  ë¿ì´ë‹ˆê¹Œìš”.

### setQueryDefaults

ì´ ë¬¸ì œì— ëŒ€í•´ ì œê°€ ë“œë¦´ ìˆ˜ ìˆëŠ” ìµœê³ ì˜ ì¡°ì–¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì˜µì…˜ì„ `useQuery`ì—ì„œ ì§ì ‘ ì„¤ì •í•˜ì§€ ë§ˆì„¸ìš”. ê°€ëŠ¥í•œ í•œ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•˜ê³  ì¬ì •ì˜í•˜ë ¤ê³  ë…¸ë ¥í•˜ê³ , íŠ¹ì • ì¿¼ë¦¬ì—ì„œ ì •ë§ë¡œ ë¬´ì–¸ê°€ë¥¼ ë³€ê²½í•´ì•¼í•œë‹¤ë©´ [queryClient.setQueryDefaults](https://react-query.tanstack.com/reference/QueryClient#queryclientsetquerydefaults)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

ì˜ˆì‹œì—ì„œì²˜ëŸ¼ ì¬ì‹œë„ ê¸°ëŠ¥ì„ `useQuery`ì—ì„œ ì„¤ì •í•˜ê¸°ë³´ë‹¤

```tsx
// not-on-useQuery

const queryClient = new QueryClient();

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  );
}

function Example() {
  // ğŸš¨ ì´ ì„¤ì •ì„ í…ŒìŠ¤íŠ¸ì—ì„œ ì¬ì •ì˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!
  const queryInfo = useQuery({
    queryKey: ['todos'],
    queryFn: fetchTodos,
    retry: 5,
  });
}
```

ì´ë ‡ê²Œ ì„¤ì •í•˜ì„¸ìš”.

```tsx
// setQueryDefaults

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 2,
    },
  },
});

// âœ… í•  ì¼ë§Œ ì¬ì‹œë„ë¥¼ 5ë²ˆ í•  ê²ƒì…ë‹ˆë‹¤.
queryClient.setQueryDefaults(['todos'], { retry: 5 });

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  );
}
```

ì´ì œ ëª¨ë“  ì¿¼ë¦¬ëŠ” ì¬ì‹œë„ë¥¼ 2ë²ˆ í•  ê²ƒì´ê³ , â€˜todosâ€™ì˜ ì¿¼ë¦¬ë§Œ 5ë²ˆ ì§„í–‰í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ì—ì„œ ëª¨ë“  ì¿¼ë¦¬ì— ëŒ€í•´ ì´ë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ì˜µì…˜ë„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤ ğŸ™Œ.

### ReactQueryConfigProvider

ë¬¼ë¡ , ì´ ê¸°ëŠ¥ì€ ì•Œë ¤ì§„ ì¿¼ë¦¬í‚¤ì—ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤. ë•Œë•Œë¡œ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì˜ ì¼ë¶€ì—ì„œë§Œ êµ¬ì„±ì„ ì„¤ì •í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. v2ì—ì„œ React QueryëŠ” ì •í™•íˆ ì´ëŸ¬í•œ ì‚¬ìš© ì‚¬ë¡€ë¥¼ ìœ„í•´ [ReactQueryConfigProvider](https://react-query-v2.tanstack.com/docs/api#reactqueryconfigprovider)ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. v3ì—ì„œë„ ëª‡ ì¤„ì˜ ì½”ë“œë¡œ ë™ì¼í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// ReactQueryConfigProvider

const ReactQueryConfigProvider = ({ children, defaultOptions }) => {
  const client = useQueryClient();
  const [newClient] = React.useState(
    () =>
      new QueryClient({
        queryCache: client.getQueryCache(),
        muationCache: client.getMutationCache(),
        defaultOptions,
      }),
  );

  return <QueryClientProvider client={newClient}>{children}</QueryClientProvider>;
};
```

ì‹¤ì œ ë™ì‘ì€ [codesandbox ì˜ˆì‹œ](https://codesandbox.io/s/react-query-config-provider-v3-lt00f)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì¿¼ë¦¬ë¥¼ í•­ìƒ ê¸°ë‹¤ë¦¬ì„¸ìš” (Always await the query)

React QueryëŠ” ë³¸ì§ˆì ìœ¼ë¡œ ë¹„ë™ê¸°ì´ë¯€ë¡œ, í›…ì„ ì‹¤í–‰í•˜ë©´, ê²°ê³¼ë¥¼ ë°”ë¡œ ì–»ì§€ ì•ŠìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì—ì„œ ë¡œë”© ìƒíƒœì¼ ê²ƒì´ë©° ë°ì´í„°ê°€ ì—†ì„ ê²ƒì…ë‹ˆë‹¤. react-hooks-testing-libraryê°€ ì œê³µí•˜ëŠ” [ë¹„ë™ê¸° ìœ í‹¸ë¦¬í‹°](https://react-hooks-testing-library.com/reference/api#async-utilities)ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ê°€ì¥ ê°„ë‹¨í•œ ê²½ìš°ì—ëŠ” ì¿¼ë¦¬ê°€ ì„±ê³µ ìƒíƒœë¡œ ì „í™˜ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// waitFor

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: {
        retry: false,
      },
    },
  });
  return ({ children }) => <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;
};

test('my first test', async () => {
  const { result, waitFor } = renderHook(() => useCustomHook(), {
    wrapper: createWrapper(),
  });

  // âœ… ì¿¼ë¦¬ê°€ ì„±ê³µ ìƒíƒœë¡œ ì „í™˜ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
  await waitFor(() => result.current.isSuccess);

  expect(result.current.data).toBeDefined();
});
```

> ğŸ’¡ **Update**
>
> ë³´ì‹œëŠ” ë°”ì™€ ê°™ì´ [@testing-library/react v13.1.0](https://github.com/testing-library/react-testing-library/releases/tag/v13.1.0)ì—ëŠ” ìƒˆë¡œìš´ [renderHook](https://testing-library.com/docs/react-testing-library/api/#renderhook)ì´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìì²´ì ìœ¼ë¡œ `waitFor` ìœ í‹¸ì„ ë°˜í™˜í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— [@testing-library/react ë¡œë¶€í„° ë¶ˆëŸ¬ì™€ì•¼ í•©ë‹ˆë‹¤](https://testing-library.com/docs/dom-testing-library/api-async/#waitfor). APIëŠ” `boolean`ì„ ë°˜í™˜í•˜ëŠ” ê²ƒì„ í—ˆìš©í•˜ì§€ ì•Šê³  `Promise`ë¥¼ ê¸°ëŒ€í•˜ê¸° ë•Œë¬¸ì— ì¡°ê¸ˆ ë‹¤ë¦…ë‹ˆë‹¤. ì´ëŠ” ì½”ë“œë¥¼ ì•½ê°„ ì¡°ì •í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
>
> ```tsx
> // new-render-hook
>
> import { waitFor, renderHook } from '@testing-library/react';
>
> test('my first test', async () => {
>   const { result } = renderHook(() => useCustomHook(), {
>     wrapper: createWrapper(),
>   });
>
>   // âœ… expectë¥¼ í†µí•´ waitForì—ê²Œ Promiseë¥¼ ë°˜í™˜
>   await waitFor(() => expect(result.current.isSuccess).toBe(true));
>
>   expect(result.current.data).toBeDefined();
> });
> ```

## ëª¨ë‘ ì‚¬ìš©í•˜ê¸° (Putting it all together)

mock-service-worker, react-testing-libraryì™€ ì–¸ê¸‰í–ˆë˜ wrapperë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë ˆí¬ì§€í† ë¦¬ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤. ì»¤ìŠ¤í…€ í›…ê³¼ ì»´í¬ë„ŒíŠ¸ì— ëŒ€í•œ ê¸°ë³¸ ì‹¤íŒ¨ì™€ ì„±ê³µ í…ŒìŠ¤íŠ¸ ë“±ì„ í¬í•¨í•˜ì—¬ 4ê°œì˜ í…ŒìŠ¤íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ë‘˜ëŸ¬ë³´ì„¸ìš”:Â https://github.com/TkDodo/testing-react-query
